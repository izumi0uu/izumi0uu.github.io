---
import { render } from "astro:content";

import { getAllProjects } from "@/modules/project/common";
import ProjectLayout from "@/layouts/Project.astro";
// import Share from "@/components/Share.astro";
import { ROUTES } from "@/constants/routes";
import { CONFIG_CLIENT } from "@/config/client";
import { getOpenGraphImagePath } from "@/libs/api/open-graph/image-path";

import type { Metadata } from "@/types/common";
import type { Project } from "@/types/project";
import { SUPPORTED_LOCALES } from "@/config/i18n";

const { SITE_URL } = CONFIG_CLIENT;

export async function getStaticPaths() {
  const projects: Project[] = await getAllProjects();

  const paths = [];

  for (const project of projects) {
    for (const locale of SUPPORTED_LOCALES) {
      paths.push({
        params: { slug: project.slug, lang: locale },
        props: { ...project, routeLocale: locale, project },
      });
    }
  }

  return paths;
}

const { data } = Astro.props;
const { pathname } = Astro.url;
const { slug } = Astro.params;

const image = getOpenGraphImagePath(pathname);
const { title, description } = data;

const metadata: Metadata = { title, description, image };

const shareProps = {
  title,
  description,
  url: `${SITE_URL}${ROUTES.PROJECT}${slug}`,
};

const { Content } = await render(Astro.props);

console.log(Content);
---

<ProjectLayout {metadata}>
  <Content />
  <!-- <Share {...shareProps} class="mt-4 md:mt-6" /> -->
</ProjectLayout>
