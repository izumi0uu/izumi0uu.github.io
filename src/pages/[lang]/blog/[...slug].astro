---
import { getAllPostsWithReadingTime } from "@/modules/post/common";
import { SUPPORTED_LOCALES } from "@/config/i18n";
import Base from "@/layouts/Base.astro";

export async function getStaticPaths() {
  const posts = await getAllPostsWithReadingTime();
  console.log(`生成博客详情页动态路由，文章数量: ${posts.length}`);

  const paths = [];

  // 遍历所有文章
  for (const post of posts) {
    // slug 格式如：2024/test-post-copy-4（包含斜杠）
    const cleanSlug = post.slug;

    // 为每种支持的语言创建路径
    for (const locale of SUPPORTED_LOCALES) {
      console.log(`为文章 ${cleanSlug} 创建 ${locale} 语言路由`);

      // 使用Catch-All路由，slug参数会接收完整的路径（包含斜杠）
      paths.push({
        params: {
          lang: locale,
          slug: cleanSlug, // 这里slug会是 "2024/test-post-copy-4"
        },
        props: {
          post,
          routeLocale: locale,
          originalSlug: post.slug,
        },
      });
    }
  }

  console.log(`总共生成 ${paths.length} 条博客详情页路由`);
  return paths;
}

const { post, routeLocale } = Astro.props;
console.log("Astro.props", Astro.props);
const { data, slug } = post;
const { title, description } = data;

// 基本元数据
const metadata = { title, description };
---

<Base {metadata}>
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-4">{title}</h1>
    {description && <p class="text-lg mb-8">{description}</p>}

    <div class="prose max-w-none">
      <!-- 内容将在后续实现 -->
      <p>文章内容将在后续实现...</p>
      <p>当前语言: {routeLocale}</p>
      <p>原始slug: {slug}</p>
    </div>
  </div>
</Base>
