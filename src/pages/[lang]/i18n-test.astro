---
import Base from '@/layouts/Base.astro';
import I18nScript from '@/components/I18nScript.astro';
import { SUPPORTED_LOCALES } from '@/config/i18n';


const metadata = {
  title: 'i18n æµ‹è¯•é¡µé¢',
  description: 'ç”¨äºæµ‹è¯•å›½é™…åŒ–åŠŸèƒ½çš„é¡µé¢',
};

export async function getStaticPaths() {
  return SUPPORTED_LOCALES.map((lang) => ({
    params: { lang },
  }));
}

const currentLocale = Astro.currentLocale || 'en';
---

<Base {metadata}>
  <main class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
      <h1 class="text-headings text-4xl font-bold mb-8">
        ğŸŒ i18n æµ‹è¯•é¡µé¢
      </h1>
      
      <div class="bg-surface-container rounded-lg p-6 mb-8">
        <h2 class="text-headings text-2xl font-semibold mb-4">å½“å‰è¯­è¨€ä¿¡æ¯</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="bg-surface-container-high rounded-md p-4">
            <h3 class="text-headings font-medium mb-2">Astro ä¿¡æ¯</h3>
            <ul class="text-content space-y-1 text-sm">
              <li><strong>å½“å‰è¯­è¨€:</strong> {currentLocale}</li>
              <li><strong>URL è·¯å¾„:</strong> {Astro.url.pathname}</li>
              <li><strong>å®Œæ•´ URL:</strong> {Astro.url.href}</li>
            </ul>
          </div>
          
          <div class="bg-surface-container-high rounded-md p-4">
            <h3 class="text-headings font-medium mb-2">é¡µé¢å†…å®¹</h3>
            <div class="text-content space-y-2 text-sm">
              {currentLocale === 'zh' ? (
                <div>
                  <p><strong>è¯­è¨€:</strong> ä¸­æ–‡</p>
                  <p><strong>é—®å€™:</strong> ä½ å¥½ï¼Œä¸–ç•Œï¼</p>
                  <p><strong>æè¿°:</strong> è¿™æ˜¯ä¸­æ–‡ç‰ˆæœ¬çš„æµ‹è¯•é¡µé¢ã€‚</p>
                </div>
              ) : (
                <div>
                  <p><strong>Language:</strong> English</p>
                  <p><strong>Greeting:</strong> Hello, World!</p>
                  <p><strong>Description:</strong> This is the English version of the test page.</p>
                </div>
              )}
            </div>
          </div>
        </div>
      </div>

      <div class="bg-surface-container rounded-lg p-6 mb-8">
        <h2 class="text-headings text-2xl font-semibold mb-4">æµ‹è¯•é“¾æ¥</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="space-y-2">
            <h3 class="text-headings font-medium">å†…éƒ¨é“¾æ¥</h3>
            <div class="space-y-1">
              <a href="/en/i18n-test" class="text-primary hover:underline block">
                ğŸ‡ºğŸ‡¸ English Version
              </a>
              <a href="/zh/i18n-test" class="text-primary hover:underline block">
                ğŸ‡¨ğŸ‡³ ä¸­æ–‡ç‰ˆæœ¬
              </a>
              <a href="/en/" class="text-primary hover:underline block">
                ğŸ  English Home
              </a>
              <a href="/zh/" class="text-primary hover:underline block">
                ğŸ  ä¸­æ–‡é¦–é¡µ
              </a>
            </div>
          </div>
          
          <div class="space-y-2">
            <h3 class="text-headings font-medium">ç›¸å¯¹é“¾æ¥æµ‹è¯•</h3>
            <div class="space-y-1">
              <a href="/" class="text-primary hover:underline block">
                æ ¹è·¯å¾„ (/)
              </a>
              <a href="../" class="text-primary hover:underline block">
                ä¸Šçº§ç›®å½• (../)
              </a>
              <a href="./i18n-test" class="text-primary hover:underline block">
                å½“å‰ç›®å½• (./i18n-test)
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="bg-surface-container rounded-lg p-6 mb-8">
        <h2 class="text-headings text-2xl font-semibold mb-4">JavaScript æµ‹è¯•</h2>
        <div class="space-y-4">
          <div class="bg-surface-container-high rounded-md p-4">
            <h3 class="text-headings font-medium mb-2">å®¢æˆ·ç«¯ä¿¡æ¯</h3>
            <div id="client-info" class="text-content text-sm space-y-1">
              <p>æ­£åœ¨åŠ è½½...</p>
            </div>
          </div>
          
          <div class="bg-surface-container-high rounded-md p-4">
            <h3 class="text-headings font-medium mb-2">å­˜å‚¨æµ‹è¯•</h3>
            <div class="space-x-2">
              <button 
                id="set-locale-en" 
                class="bg-primary text-on-primary px-3 py-1 rounded text-sm hover:opacity-90"
              >
                è®¾ç½®è‹±æ–‡åå¥½
              </button>
              <button 
                id="set-locale-zh" 
                class="bg-primary text-on-primary px-3 py-1 rounded text-sm hover:opacity-90"
              >
                è®¾ç½®ä¸­æ–‡åå¥½
              </button>
              <button 
                id="clear-locale" 
                class="bg-error text-on-error px-3 py-1 rounded text-sm hover:opacity-90"
              >
                æ¸…é™¤åå¥½
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="bg-surface-container rounded-lg p-6">
        <h2 class="text-headings text-2xl font-semibold mb-4">ä½¿ç”¨è¯´æ˜</h2>
        <div class="text-content space-y-3 text-sm">
          <p>
            <strong>å¼€å‘å·¥å…·æ :</strong> åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œä½ ä¼šåœ¨é¡µé¢å·¦ä¸Šè§’çœ‹åˆ° i18n å¼€å‘å·¥å…·æ ã€‚
            å®ƒæä¾›äº†ä»¥ä¸‹åŠŸèƒ½ï¼š
          </p>
          <ul class="list-disc list-inside space-y-1 ml-4">
            <li><strong>å½“å‰çŠ¶æ€:</strong> æ˜¾ç¤ºå½“å‰è¯­è¨€ã€è·¯å¾„ã€æµè§ˆå™¨è¯­è¨€ç­‰ä¿¡æ¯</li>
            <li><strong>è¯­è¨€åˆ‡æ¢:</strong> å¿«é€Ÿåˆ‡æ¢åˆ°ä¸åŒè¯­è¨€ç‰ˆæœ¬</li>
            <li><strong>è¯­è¨€åå¥½:</strong> è®¾ç½®æˆ–æ¸…é™¤å­˜å‚¨çš„è¯­è¨€åå¥½</li>
            <li><strong>é‡å®šå‘æµ‹è¯•:</strong> æµ‹è¯•è‡ªåŠ¨é‡å®šå‘é€»è¾‘</li>
            <li><strong>URL é¢„è§ˆ:</strong> æŸ¥çœ‹ä¸åŒè¯­è¨€çš„ URL æ ¼å¼</li>
            <li><strong>è°ƒè¯•ä¿¡æ¯:</strong> æ˜¾ç¤ºé…ç½®å‚æ•°å’Œå­˜å‚¨é”®</li>
          </ul>
          <p>
            <strong>æµ‹è¯•æ­¥éª¤:</strong>
          </p>
          <ol class="list-decimal list-inside space-y-1 ml-4">
            <li>ä½¿ç”¨å¼€å‘å·¥å…·æ åˆ‡æ¢è¯­è¨€ï¼Œè§‚å¯Ÿ URL å’Œé¡µé¢å†…å®¹å˜åŒ–</li>
            <li>è®¾ç½®è¯­è¨€åå¥½ï¼Œç„¶ååˆ·æ–°é¡µé¢æµ‹è¯•æ˜¯å¦ä¿æŒ</li>
            <li>æ¸…é™¤åå¥½åæµ‹è¯•è‡ªåŠ¨é‡å®šå‘åŠŸèƒ½</li>
            <li>åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­ä¿®æ”¹è¯­è¨€è®¾ç½®æµ‹è¯•æ¨æ–­é€»è¾‘</li>
          </ol>
        </div>
      </div>
    </div>
  </main>

  <!-- å®¢æˆ·ç«¯è„šæœ¬ -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // æ›´æ–°å®¢æˆ·ç«¯ä¿¡æ¯
      const updateClientInfo = () => {
        const clientInfo = document.getElementById('client-info');
        if (clientInfo) {
          clientInfo.innerHTML = `
            <p><strong>å½“å‰ URL:</strong> ${window.location.href}</p>
            <p><strong>è·¯å¾„å:</strong> ${window.location.pathname}</p>
            <p><strong>æµè§ˆå™¨è¯­è¨€:</strong> ${navigator.language}</p>
            <p><strong>ç”¨æˆ·ä»£ç†:</strong> ${navigator.userAgent.substring(0, 100)}...</p>
            <p><strong>å­˜å‚¨çš„è¯­è¨€åå¥½:</strong> ${localStorage.getItem('user-preferred-lang') || 'æ— '}</p>
            <p><strong>é‡å®šå‘æ ‡è®°:</strong> ${sessionStorage.getItem('browser-lang-redirect-done') ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®'}</p>
          `;
        }
      };

      updateClientInfo();

      // å­˜å‚¨æµ‹è¯•æŒ‰é’®
      document.getElementById('set-locale-en')?.addEventListener('click', () => {
        localStorage.setItem('user-preferred-lang', 'en');
        updateClientInfo();
        alert('å·²è®¾ç½®è‹±æ–‡åå¥½');
      });

      document.getElementById('set-locale-zh')?.addEventListener('click', () => {
        localStorage.setItem('user-preferred-lang', 'zh');
        updateClientInfo();
        alert('å·²è®¾ç½®ä¸­æ–‡åå¥½');
      });

      document.getElementById('clear-locale')?.addEventListener('click', () => {
        localStorage.removeItem('user-preferred-lang');
        sessionStorage.removeItem('browser-lang-redirect-done');
        updateClientInfo();
        alert('å·²æ¸…é™¤æ‰€æœ‰åå¥½è®¾ç½®');
      });

      // ç›‘å¬å­˜å‚¨å˜åŒ–
      window.addEventListener('storage', updateClientInfo);
    });
  </script>

  <!-- åŒ…å« i18n è„šæœ¬ -->
  <I18nScript />
</Base> 