---
// Tailwind v4 ä¸»é¢˜ç³»ç»Ÿæ¼”ç¤ºç»„ä»¶ - æ”¯æŒå›½é™…åŒ–
// å±•ç¤ºæ–°çš„é¢œè‰²ç³»ç»Ÿã€å·¥å…·ç±»å’Œä¸»é¢˜åˆ‡æ¢åŠŸèƒ½

// è·å–å½“å‰è¯­è¨€ï¼Œä» URL è·¯å¾„ä¸­æå–
const currentPath = Astro.url.pathname;
const isZh = currentPath.startsWith('/zh');

// å®šä¹‰å¤šè¯­è¨€æ–‡æœ¬
const texts = {
  title: isZh ? "ğŸ¨ Tailwind v4 ä¸»é¢˜æ¼”ç¤º" : "ğŸ¨ Tailwind v4 Theme Showcase",
  defaultTheme: isZh ? "é»˜è®¤ä¸»é¢˜" : "Default Theme",
  darkMode: isZh ? "æš—è‰²æ¨¡å¼" : "Dark Mode", 
  wineTheme: isZh ? "é…’çº¢ä¸»é¢˜" : "Wine Theme",
  wineDark: isZh ? "é…’çº¢æš—è‰²" : "Wine Dark",
  currentTheme: isZh ? "å½“å‰ä¸»é¢˜" : "Current Theme",
  primaryColors: isZh ? "ä¸»è‰²ç³»" : "Primary Colors",
  surfaceSystem: isZh ? "è¡¨é¢ç³»ç»Ÿ" : "Surface System", 
  functionalColors: isZh ? "åŠŸèƒ½è‰²ç³»" : "Functional Colors",
  debugInfo: isZh ? "ğŸ”§ è°ƒè¯•ä¿¡æ¯" : "ğŸ”§ Debug Info"
};
---

<div class="theme-showcase">
  <!-- ä¸»é¢˜åˆ‡æ¢å™¨ -->
  <div class="mb-8 p-6 surface-container">
    <h2 class="text-2xl font-bold text-on-surface mb-4">{texts.title}</h2>
    <div class="flex flex-wrap gap-4 mb-4">
      <button 
        id="theme-default" 
        class="btn-secondary"
        data-theme="default"
      >
        {texts.defaultTheme}
      </button>
      <button 
        id="theme-dark" 
        class="btn-secondary"
        data-theme="dark"
      >
        {texts.darkMode}
      </button>
      <button 
        id="theme-wine" 
        class="btn-secondary"
        data-theme="wine"
      >
        {texts.wineTheme}
      </button>
      <button 
        id="theme-wine-dark" 
        class="btn-secondary"
        data-theme="wine-dark"
      >
        {texts.wineDark}
      </button>
    </div>
    <p class="text-on-surface-variant text-sm">
      {texts.currentTheme}: <span id="current-theme" class="text-primary font-medium">default</span>
    </p>
  </div>

  <!-- é¢œè‰²ç³»ç»Ÿå±•ç¤º -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
    <!-- ä¸»è‰²ç³» -->
    <div class="card">
      <h3 class="text-lg font-semibold text-on-surface mb-4">{texts.primaryColors}</h3>
      <div class="space-y-3">
        <div class="flex items-center gap-3">
          <div class="w-8 h-8 rounded bg-primary border border-outline"></div>
          <div>
            <div class="text-sm font-medium text-on-surface">Primary</div>
            <div class="text-xs text-on-surface-variant">var(--color-primary)</div>
          </div>
        </div>
      </div>
    </div>

    <!-- è¡¨é¢ç³»ç»Ÿ -->
    <div class="card">
      <h3 class="text-lg font-semibold text-on-surface mb-4">{texts.surfaceSystem}</h3>
      <div class="space-y-3">
        <div class="flex items-center gap-3">
          <div class="w-8 h-8 rounded bg-surface border border-outline"></div>
          <div>
            <div class="text-sm font-medium text-on-surface">Surface</div>
            <div class="text-xs text-on-surface-variant">var(--color-surface)</div>
          </div>
        </div>
      </div>
    </div>

    <!-- åŠŸèƒ½è‰²ç³» -->
    <div class="card">
      <h3 class="text-lg font-semibold text-on-surface mb-4">{texts.functionalColors}</h3>
      <div class="space-y-3">
        <div class="flex items-center gap-3">
          <div class="w-8 h-8 rounded border border-outline" style="background-color: var(--color-error);"></div>
          <div>
            <div class="text-sm font-medium text-on-surface">Error</div>
            <div class="text-xs text-on-surface-variant">var(--color-error)</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- è°ƒè¯•ä¿¡æ¯ -->
  <div class="card mt-6" id="debug-info">
    <h3 class="text-lg font-semibold text-on-surface mb-4">{texts.debugInfo}</h3>
    <div class="text-sm font-mono text-on-surface-variant space-y-1" id="css-variables">
      <!-- JavaScript åŠ¨æ€å¡«å…… -->
    </div>
  </div>
</div>

<script>
  // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ - ä¿®å¤å¯¹è±¡æ ¼å¼é”™è¯¯
  function setTheme(themeInput: string | any): void {
    // å®‰å…¨å¤„ç†ä¸»é¢˜å€¼ï¼Œé˜²æ­¢å¯¹è±¡ä¼ å…¥
    let theme: string;
    
    if (typeof themeInput === 'string') {
      theme = themeInput;
    } else if (themeInput && typeof themeInput === 'object' && themeInput.name) {
      theme = themeInput.name;
    } else {
      theme = String(themeInput);
    }
    
    // æ¸…ç†å¯èƒ½çš„JSONå­—ç¬¦ä¸²
    if (theme.startsWith('{') && theme.endsWith('}')) {
      try {
        const parsed = JSON.parse(theme);
        if (parsed && parsed.name) {
          theme = parsed.name;
        }
      } catch {
        theme = 'default';
      }
    }
    
    // éªŒè¯ä¸»é¢˜å€¼
    const validThemes = ['default', 'dark', 'wine', 'wine-dark'];
    if (!validThemes.includes(theme)) {
      theme = 'default';
    }
    
    console.log(`ğŸ¨ è®¾ç½®ä¸»é¢˜: ${theme}`);
    
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    
    // æ›´æ–°å½“å‰ä¸»é¢˜æ˜¾ç¤º
    const currentThemeEl = document.getElementById('current-theme');
    if (currentThemeEl) {
      currentThemeEl.textContent = theme;
    }
    
    // æ›´æ–°æŒ‰é’®çŠ¶æ€
    document.querySelectorAll('[data-theme]').forEach(btn => {
      btn.classList.remove('btn-primary');
      btn.classList.add('btn-secondary');
    });
    
    // å®‰å…¨åœ°æŸ¥æ‰¾å¯¹åº”æŒ‰é’®
    try {
      const escapedTheme = CSS.escape(theme);
      const activeBtn = document.querySelector(`[data-theme="${escapedTheme}"]`);
      if (activeBtn) {
        activeBtn.classList.remove('btn-secondary');
        activeBtn.classList.add('btn-primary');
      }
    } catch (error) {
      console.warn('ä¸»é¢˜æŒ‰é’®é€‰æ‹©å™¨é”™è¯¯:', error);
      // å›é€€åˆ°ç®€å•æŸ¥æ‰¾
      const allButtons = document.querySelectorAll('[data-theme]');
      for (const btn of allButtons) {
        if (btn.getAttribute('data-theme') === theme) {
          btn.classList.remove('btn-secondary');
          btn.classList.add('btn-primary');
          break;
        }
      }
    }
    
    updateDebugInfo();
  }

  // æ›´æ–°è°ƒè¯•ä¿¡æ¯
  function updateDebugInfo(): void {
    const debugEl = document.getElementById('css-variables');
    if (!debugEl) return;
    
    const currentTheme = document.documentElement.getAttribute('data-theme') || 'default';
    const styles = getComputedStyle(document.documentElement);
    
    // æ ¹æ®å½“å‰è¯­è¨€æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
    const isZh = window.location.pathname.startsWith('/zh');
    let debugHtml = `<div class="font-bold mb-2">${isZh ? 'å½“å‰ä¸»é¢˜' : 'Current Theme'}: ${currentTheme}</div>`;
    
    // æ˜¾ç¤ºå…³é”®é¢œè‰²å˜é‡
    const keyColors = [
      '--color-primary',
      '--color-secondary', 
      '--color-surface',
      '--color-background'
    ];
    
    keyColors.forEach(colorVar => {
      const value = styles.getPropertyValue(colorVar).trim();
      if (value) {
        debugHtml += `<div>${colorVar}: ${value}</div>`;
      }
    });
    
    debugEl.innerHTML = debugHtml;
  }

  // åˆå§‹åŒ–
  document.addEventListener('DOMContentLoaded', () => {
    console.log('ğŸš€ ThemeShowcase åˆå§‹åŒ–');
    
    // å®‰å…¨è¯»å–ä¿å­˜çš„ä¸»é¢˜
    let savedTheme = localStorage.getItem('theme') || 'default';
    
    // å¤„ç†å¯èƒ½æŸåçš„localStorageæ•°æ®
    try {
      if (savedTheme.startsWith('{')) {
        const parsed = JSON.parse(savedTheme);
        savedTheme = parsed.name || 'default';
        // ä¿®å¤æŸåçš„æ•°æ®
        localStorage.setItem('theme', savedTheme);
      }
    } catch {
      console.warn('ä¿®å¤æŸåçš„ä¸»é¢˜æ•°æ®');
      savedTheme = 'default';
      localStorage.setItem('theme', 'default');
    }
    
    setTheme(savedTheme);
    
    // ç»‘å®šä¸»é¢˜åˆ‡æ¢æŒ‰é’®
    document.querySelectorAll('[data-theme]').forEach(button => {
      button.addEventListener('click', (e: Event) => {
        const target = e.target as HTMLElement;
        const theme = target.getAttribute('data-theme');
        if (theme) {
          setTheme(theme);
        }
      });
    });
    
    // ç³»ç»Ÿä¸»é¢˜æ£€æµ‹
    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
    mediaQuery.addEventListener('change', (e) => {
      const currentTheme = localStorage.getItem('theme');
      if (currentTheme === 'default') {
        setTheme(e.matches ? 'dark' : 'default');
      }
    });
  });
</script>

<style>
  /* ç¡®ä¿è‡ªå®šä¹‰å˜ä½“æ­£å¸¸å·¥ä½œ */
  .theme-wine\:block {
    display: none;
  }
  
  :root[data-theme="wine"] .theme-wine\:block {
    display: block;
  }
  
  .theme-wine-dark\:block {
    display: none;
  }
  
  :root[data-theme="wine-dark"] .theme-wine-dark\:block {
    display: block;
  }
</style> 