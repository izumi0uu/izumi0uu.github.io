---
import { Icon } from "astro-icon/components";

import Link from "@/components/Link.astro";
import { ROUTES } from "@/constants/routes";
import { CONFIG_CLIENT } from "@/config/client";

import { Logo } from "@/components/react/ui/Logo";

import { getLatestCommitInfo } from "@/libs/git";
import { shortDate } from "@/utils/data/datetime";
import { limitString, trimHttpProtocol } from "@/utils/data/strings";
import { cn } from "@/utils/ui/styles";
import * as m from "@/paraglide/messages";

const { SITE_URL, AUTHOR_LINKEDIN, AUTHOR_GITHUB, REPO_URL, AUTHOR_NAME } = CONFIG_CLIENT;
const domain = trimHttpProtocol(SITE_URL);
const messageLength = 15 as const;

const { time, fullHash, message } = getLatestCommitInfo();

const commitUrl = `${REPO_URL}/commit/${fullHash}`;
const shortDateStr = shortDate(new Date(time));
const trimmedMessage = limitString(message, messageLength);

// å¯¼èˆªé“¾æ¥é…ç½®
const footerNavigation = {
  resources: [
    { name: "Blog", href: ROUTES.BLOG },
    { name: "Projects", href: ROUTES.PROJECTS },
    { name: "About", href: ROUTES.ABOUT },
  ],
  quickInfo: [
    { name: "Contact", href: ROUTES.CONTACT },
    { name: "RSS Feed", href: ROUTES.API.FEED_RSS },
    { name: "Sitemap", href: "/sitemap.xml" },
  ],
  social: [
    { name: "GitHub", href: AUTHOR_GITHUB, icon: "mdi:github" },
    { name: "LinkedIn", href: AUTHOR_LINKEDIN, icon: "mdi:linkedin" },
  ]
};
---

<footer 
  class={cn(
    "border-t border-outline bg-surface-container",
    "py-12 px-4 mt-auto"
  )}
  role="contentinfo"
  aria-label="ç½‘ç«™é¡µè„š"
>
  <div class="max-w-7xl mx-auto">
    <div class="grid grid-cols-1 md:grid-cols-12 gap-8 lg:gap-12">
      
      <!-- Brand Section -->
      <section class="md:col-span-5 lg:col-span-4" aria-labelledby="brand-heading">
        <div class="space-y-4">
          <!-- Brand Logo and Name -->
          <Link 
            href="/" 
            variant="no-underline"
            class={cn(
              "inline-flex items-center gap-3",
              "text-content hover:text-primary transition-colors"
            )}
            aria-label="è¿”å›é¦–é¡µ"
          >
            <Logo />
            <span class="text-xl font-bold tracking-tight">
              {AUTHOR_NAME}
            </span>
          </Link>
          
          <!-- Brand Description -->
          <p class={cn(
            "text-content leading-relaxed max-w-md",
            "text-sm"
          )}>
            ä¸€ä¸ªåˆ†äº«æƒ³æ³•å’Œåˆ›æ„çš„åœ°æ–¹ã€‚åœ¨è¿™é‡Œè®°å½•æŠ€æœ¯æ€è€ƒã€é¡¹ç›®ç»éªŒå’Œç”Ÿæ´»æ„Ÿæ‚Ÿã€‚
          </p>
          
          <!-- Latest Commit Info -->
          <div class="flex items-center gap-2 text-xs text-content">
            <Icon name="mdi:github" class="h-4 w-4 fill-current" />
            <span class="font-medium">æœ€æ–°æäº¤:</span>
            <Link 
              href={commitUrl} 
              title={`${shortDateStr} - ${message}`}
              target="_blank"
              class="hover:text-primary transition-colors"
            >
              {trimmedMessage}
            </Link>
          </div>
        </div>
      </section>

      <!-- Navigation Section -->
      <nav class="md:col-span-7 lg:col-span-6" aria-label="é¡µè„šå¯¼èˆª">
        <div class="grid grid-cols-2 lg:grid-cols-3 gap-8">
          
          <!-- Resources Links -->
          <section aria-labelledby="resources-heading">
            <h3 
              id="resources-heading"
              class={cn(
                "text-content font-semibold mb-4",
                "text-sm"
              )}
            >
              å†…å®¹å¯¼èˆª
            </h3>
            <ul class="space-y-3" role="list">
              {footerNavigation.resources.map((item) => (
                <li>
                  <Link
                    href={item.href}
                    class={cn(
                      "text-content hover:text-primary",
                      "transition-colors text-sm",
                      "inline-flex items-center gap-1"
                    )}
                  >
                    {item.name}
                  </Link>
                </li>
              ))}
            </ul>
          </section>

          <!-- Quick Info Links -->
          <section aria-labelledby="info-heading">
            <h3 
              id="info-heading"
              class={cn(
                "text-content font-semibold mb-4",
                "text-sm"
              )}
            >
              å¿«é€Ÿé“¾æ¥
            </h3>
            <ul class="space-y-3" role="list">
              {footerNavigation.quickInfo.map((item) => (
                <li>
                  <Link
                    href={item.href}
                    class={cn(
                      "text-content hover:text-primary",
                      "transition-colors text-sm",
                      "inline-flex items-center gap-1"
                    )}
                  >
                    {item.name}
                  </Link>
                </li>
              ))}
            </ul>
          </section>

          <!-- Social Links -->
          <section aria-labelledby="social-heading" class="col-span-2 lg:col-span-1">
            <h3 
              id="social-heading"
              class={cn(
                "text-content font-semibold mb-4",
                "text-sm"
              )}
            >
              ç¤¾äº¤åª’ä½“
            </h3>
            <ul class="flex flex-wrap gap-3 lg:flex-col lg:space-y-3" role="list">
              {footerNavigation.social.map((item) => (
                <li>
                  <Link
                    href={item.href}
                    target="_blank"
                    rel="me noreferrer noopener"
                    class={cn(
                      "inline-flex items-center gap-2",
                        "text-content hover:text-primary",
                      "transition-colors text-sm"
                    )}
                    aria-label={`åœ¨ ${item.name} ä¸Šå…³æ³¨æˆ‘`}
                  >
                    <!-- ä¸´æ—¶ä½¿ç”¨emojiï¼Œç›´åˆ°é…ç½®astro-icon -->
                    <span class="text-base" aria-hidden="true">
                      {item.name === "GitHub" ? "ğŸ“" : "ğŸ’¼"}
                    </span>
                    <span>{item.name}</span>
                  </Link>
                </li>
              ))}
            </ul>
          </section>
        </div>
      </nav>
    </div>

    <!-- Copyright Section -->
    <section 
      class={cn(
        "mt-12 pt-8 border-t border-outline-variant",
        "flex flex-col md:flex-row justify-between items-center gap-4"
      )}
      aria-label="ç‰ˆæƒä¿¡æ¯"
    >
      <p class={cn(
        "text-content text-xs lg:text-sm",
        "text-center md:text-left"
      )}>
        Â© {new Date().getFullYear()} {AUTHOR_NAME}. ä¿ç•™æ‰€æœ‰æƒåˆ©
      </p>
      
      <!-- Additional Meta Info -->
      <div class={cn(
        "text-content text-xs",
        "flex items-center gap-4"
      )}>
        <span>ç«™ç‚¹åŸŸå: {domain}</span>
        <span>â€¢</span>
        <span>ä½¿ç”¨ Astro æ„å»º</span>
      </div>
    </section>
  </div>
</footer>
